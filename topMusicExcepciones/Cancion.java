package topMusicExcepciones;

import java.util.Calendar;
import java.util.regex.Pattern;

/**
 * El usuario podrá:
 * 
 * a. Añadir una canción (en una posición) al TopMusic.
 * b. Sacar un elemento del TopMusic.
 * c. Subir un puesto en el TopMusic.
 * d. Bajar un puesto en el TopMusic.
 * e. Mostrar la lista TopMusic.
 * f. Mostrar la canción más escuchada.
 * 
 * Sobre la canción se almacenará el título, artista o grupo y año de grabación.
 * 
 * Top Music (Con excepciones). 
 * Mejoremos la versión anterior, pero como conocemos QUÉ ES una excepción, vamos a utilizarla. 
 * Los errores los controlaremos mediante las siguientes excepciones:
 *
 * 1. FechaNoValidaException
 * 2. CancionNoValidaException.
 * 3. AutorNoValidoException
 * 4. PosicionNoValidaException
 * 
 * Y recuerda:
 * 
 * 1. En caso de error, el usuario ha de saber CON EXACTITUD cuál ha sido el problema.
 * 		1. Error al insertar la canción: título no es válido.
 * 		2. Error al insertar la canción: autor no es válido
 * 		3. Error al borrar la canción: posición no válida
 * 		4. Error al bajar la canción: posición no válida.
 * 		5. Error al subir la canción: la canción está la primera.
 * 2. El método Cancion.getInstance() ya no es necesario.
 * 3. Sigue usando expresiones regulares
 * 
 * Utiliza pruebas unitarias para el control de errores.
 * 
 * - El título de la canción: Me too, Don´t let me down, 19 días y 500 noches, Come...
 * - El autor/grupo: The B-52's, Jain...
 * - El año: Nunca posterior al año actual
 * 
 * @author Victoriano Sevillano Vega
 * @version 1.0
 *
 */
public class Cancion {
	/**
	 * Clase calendario
	 */
	private static final Calendar CALENDAR = Calendar.getInstance();

	/**
	 * Obtenemos el año actual de la clase calendario
	 */
	private static final int ANNIO = CALENDAR.get(Calendar.YEAR);

	/**
	 * Titulo de la cancion
	 */
	private String titulo;

	/**
	 * Artista de la cancion
	 */
	private String artista;

	/**
	 * Año de grabacion
	 */
	private int anoGrabacion;

	/**
	 * Patron para el titulo y el artista
	 */
	private static final Pattern patronNombre = Pattern.compile("([´,'\\-a-zA-ZáéíóúñÑ0-9]+\\s?){2,}");

	/**
	 * Determina si el nombre es valido
	 * 
	 * @param nombre
	 * @return
	 */
	private static boolean nombreValido(String nombre) {
		return patronNombre.matcher(nombre).matches();
	}

	/**
	 * Constructor de la cancion
	 * 
	 * @param titulo
	 *            de la cancion
	 * @param artista
	 *            de la cancion
	 * @param anoGrabacion
	 *            Año de grabacion
	 * @throws AutorNoValidoException
	 *             Si el autor no es valido
	 * @throws CancionNoValidoException
	 *             Si el titulo no es valido
	 * @throws FechaNoValidaException
	 *             Si la fecha no es valida
	 */
	public Cancion(String titulo, String artista, int anoGrabacion) throws Exception {
		setTitulo(titulo);
		setArtista(artista);
		setAnoGrabacion(anoGrabacion);
	}

	/**
	 * Obtiene el titulo de la cancion
	 * 
	 * @return
	 */
	private String getTitulo() {
		return titulo;
	}

	/**
	 * Modifica el titulo de la cancion
	 * 
	 * @param titulo
	 * @throws CancionNoValidoException
	 *             Si el titulo de la cancion no es valido
	 */
	private void setTitulo(String titulo) throws CancionNoValidoException {
		if (nombreValido(titulo))
			this.titulo = titulo;
		else
			throw new CancionNoValidoException("El titulo no es valido");
	}

	/**
	 * Obtiene el artista
	 * 
	 * @return el nombre del artista
	 */
	private String getArtista() {
		return artista;
	}

	/**
	 * Modifica el valor de artista
	 * 
	 * @param artista
	 *            de la cancion
	 * @throws AutorNoValidoException
	 *             Si el formato del autor no es valido
	 */
	private void setArtista(String artista) throws AutorNoValidoException {
		if (nombreValido(artista))
			this.artista = artista;
		else
			throw new AutorNoValidoException("El artista no es valido");
	}

	/**
	 * Obtiene el año de grabacion
	 * 
	 * @return año de grabacion
	 */
	private int getAnoGrabacion() {
		return anoGrabacion;
	}

	/**
	 * Modifica el valor de año de grabacion
	 * 
	 * @param anoGrabacion
	 *            año en el cual se grabo la cancion
	 * @throws FechaNoValidaException
	 *             Si la fecha no es valida
	 */
	private void setAnoGrabacion(int anoGrabacion) throws FechaNoValidaException {
		if (anoGrabacion > 1950 && anoGrabacion <= ANNIO)
			this.anoGrabacion = anoGrabacion;
		else
			throw new FechaNoValidaException("La fecha no es valida");
	}

	/*
	 * (non-Javadoc)
	 * 
	 * @see java.lang.Object#toString()
	 */
	@Override
	public String toString() {
		return "" + getTitulo() + ", por " + getArtista() + " (" + getAnoGrabacion() + ")";
	}
}